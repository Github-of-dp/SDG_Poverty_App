<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>BetterLife // SDG Resilience Architect</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;700&display=swap" rel="stylesheet">
    <style>
        :root { --neon: #ccff00; --red: #ff0055; --bg: #050505; }
        body { background: var(--bg); color: #fff; font-family: 'Space Grotesk', sans-serif; }
        
        .glow-card { 
            background: rgba(20, 20, 20, 0.6); backdrop-filter: blur(12px); 
            border: 1px solid rgba(255,255,255,0.05); border-radius: 20px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5); transition: 0.3s;
        }
        .glow-card:hover { border-color: var(--neon); box-shadow: 0 0 20px rgba(204, 255, 0, 0.1); }
        
        .neon-text { color: var(--neon); text-shadow: 0 0 10px rgba(204, 255, 0, 0.5); }
        .neon-border { border-color: var(--neon); box-shadow: 0 0 15px rgba(204, 255, 0, 0.2); }
        
        input { background: #111; border: 1px solid #333; color: var(--neon); padding: 12px; border-radius: 12px; width: 100%; outline: none; transition: 0.3s; }
        input:focus { border-color: var(--neon); box-shadow: 0 0 15px rgba(204, 255, 0, 0.3); }

        .btn-action { background: #fff; color: #000; font-weight: 800; padding: 12px; border-radius: 12px; transition: 0.3s; }
        .btn-action:hover { background: var(--neon); transform: translateY(-2px); }

        .terminal-box { font-family: monospace; font-size: 12px; background: #000; border: 1px dashed #333; height: 120px; overflow-y: auto; padding: 10px; }
    </style>
</head>
<body class="p-6 md:p-12">

    <div id="modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/90 backdrop-blur-xl">
        <div class="glow-card max-w-md p-10 text-center border-white/10">
            <h2 class="text-3xl font-bold mb-4 italic neon-text">ARCHITECT // 1.2</h2>
            <p class="text-gray-400 text-sm mb-8 leading-relaxed">Educational simulation of Sustainable Development Goal 1.2. Not for real-world financial advice.</p>
            <button onclick="document.getElementById('modal').remove()" class="btn-action w-full">INITIALIZE SYSTEM</button>
        </div>
    </div>

    <div class="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-10">
        
        <div class="lg:col-span-4 space-y-6">
            <header class="mb-10">
                <h1 class="text-4xl font-black tracking-tighter uppercase">BetterLife <span class="neon-text">AI</span></h1>
                <select id="region" onchange="run()" class="bg-transparent neon-text font-bold mt-2 outline-none">
                    {% for r in regions %}<option value="{{ r }}">{{ r }}</option>{% endfor %}
                </select>
            </header>

            <div class="glow-card p-6 space-y-4">
                <h3 class="text-[10px] text-gray-500 font-bold uppercase tracking-widest">Household Data</h3>
                <input type="number" id="income" placeholder="Monthly Income" value="10000" oninput="run()">
                <input type="number" id="edu" placeholder="Years of Schooling" value="12" oninput="run()">
                <div class="grid grid-cols-2 gap-4">
                    <input type="number" id="h_size" value="4" oninput="run()">
                    <input type="number" id="workers" value="1" oninput="run()">
                </div>
            </div>

            <div class="glow-card p-6">
                <h3 class="text-[10px] text-gray-500 font-bold uppercase mb-4 tracking-widest">Active Interventions</h3>
                <div class="grid grid-cols-1 gap-2">
                    <button onclick="invest('edu')" class="text-[11px] border border-white/10 p-3 rounded-lg hover:border-[#ccff00] text-left">
                        üéì Vocational Training (+2 yrs Edu)
                    </button>
                    <button onclick="invest('health')" class="text-[11px] border border-white/10 p-3 rounded-lg hover:border-[#ccff00] text-left">
                        üè• Health Insurance (Resilience Block)
                    </button>
                </div>
            </div>

            <button onclick="triggerEvent()" class="btn-action w-full uppercase tracking-tighter">Simulate Life Event</button>
            <div id="terminal" class="terminal-box text-gray-500">> System Ready...</div>
        </div>

        <div class="lg:col-span-8 space-y-8">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="glow-card p-10 flex flex-col items-center justify-center text-center">
                    <span class="text-[10px] text-gray-500 font-bold uppercase mb-4">Current Vulnerability</span>
                    <div id="risk-display" class="text-8xl font-black neon-text">0%</div>
                    <div class="w-full h-1.5 bg-white/5 rounded-full mt-8 overflow-hidden">
                        <div id="risk-bar" class="h-full bg-[#ccff00] transition-all duration-700" style="width: 0%"></div>
                    </div>
                </div>

                <div class="glow-card p-10 flex flex-col items-center justify-center text-center border-white/10">
                    <span class="text-[10px] text-gray-400 font-bold uppercase mb-4">2030 Horizon Prediction</span>
                    <div id="future-display" class="text-6xl font-black text-white/40 italic">0%</div>
                    <p class="text-[10px] text-gray-500 mt-6 leading-tight">Adjusted for 3% net economic drift.</p>
                </div>
            </div>

            <div class="glow-card p-8">
                <h3 class="text-[10px] text-gray-500 font-bold uppercase mb-6 tracking-widest">Impact Breakdown</h3>
                <div id="factor-list" class="space-y-6">
                    </div>
            </div>
        </div>
    </div>

    <script>
        async function run() {
            const data = {
                income: document.getElementById('income').value,
                education: document.getElementById('edu').value,
                h_size: document.getElementById('h_size').value,
                workers: document.getElementById('workers').value,
                region: document.getElementById('region').value
            };

            const res = await fetch('/analyze', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(data)
            });
            const r = await res.json();

            // UI Updates
            document.getElementById('risk-display').innerText = r.total + "%";
            document.getElementById('risk-bar').style.width = r.total + "%";
            document.getElementById('future-display').innerText = r.future + "%";

            // Color shift logic for risk bar
            document.getElementById('risk-bar').style.backgroundColor = r.total > 50 ? "#ff0055" : "#ccff00";
            document.getElementById('risk-display').style.color = r.total > 50 ? "#ff0055" : "#ccff00";

            const flist = document.getElementById('factor-list');
            flist.innerHTML = '';
            r.factors.forEach(f => {
                flist.innerHTML += `
                    <div class="flex items-center gap-6">
                        <div class="w-24 text-[10px] font-bold text-gray-400 uppercase">${f.name}</div>
                        <div class="flex-1 h-1 bg-white/5 rounded-full overflow-hidden">
                            <div class="h-full transition-all duration-1000" style="width:${f.val * 2}%; background:${f.color}"></div>
                        </div>
                        <div class="w-12 text-right font-bold text-xs" style="color:${f.color}">${f.val}%</div>
                    </div>
                `;
            });
        }

        function log(msg) {
            const t = document.getElementById('terminal');
            t.innerHTML = `<div>> ${msg}</div>` + t.innerHTML;
        }

        function invest(type) {
            if(type === 'edu') {
                document.getElementById('edu').value = parseInt(document.getElementById('edu').value) + 2;
                log("Investment: Vocational Training complete. Education +2 yrs.");
            } else {
                log("Investment: Health Insurance active. Protection +10%.");
            }
            run();
        }

        function triggerEvent() {
            const events = [
                {n: "Inflation Spike", i: -1500, msg: "Economic Shift: Market prices rose by 12%."},
                {n: "Local Job Loss", w: -1, msg: "Structural Shock: Household earner lost employment."},
                {n: "Community Grant", i: 2000, msg: "External Support: Local NGO provided social grant."}
            ];
            const e = events[Math.floor(Math.random()*events.length)];
            if(e.i) document.getElementById('income').value = parseInt(document.getElementById('income').value) + e.i;
            if(e.w) document.getElementById('workers').value = Math.max(0, parseInt(document.getElementById('workers').value) + e.w);
            log(`EVENT: ${e.n}. ${e.msg}`);
            run();
        }

        window.onload = run;
    </script>
</body>
</html>
