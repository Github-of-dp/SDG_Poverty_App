<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SDG-1 // NEURAL TERMINAL</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --neon: #ccff00; --dark: #050505; --panel: #111; }
        body { background: var(--dark); color: #ccc; font-family: 'JetBrains Mono', monospace; overflow-x: hidden; }
        
        /* Cyberpunk FX */
        .scanline {
            width: 100%; height: 2px; background: rgba(204, 255, 0, 0.1);
            position: fixed; top: 0; left: 0; pointer-events: none; z-index: 50;
            animation: scan 6s linear infinite;
        }
        @keyframes scan { 0% {top: -10%;} 100% {top: 110%;} }
        
        .panel { 
            background: var(--panel); border: 1px solid #333; padding: 20px; 
            position: relative; overflow: hidden;
        }
        .panel::before {
            content: ""; position: absolute; top: 0; left: 0; width: 4px; height: 100%;
            background: #333; transition: 0.3s;
        }
        .panel:hover::before { background: var(--neon); }
        
        input, select { 
            background: #000; border: 1px solid #444; color: var(--neon); 
            padding: 10px; width: 100%; font-family: inherit; outline: none;
        }
        input:focus { border-color: var(--neon); box-shadow: 0 0 10px rgba(204, 255, 0, 0.2); }
        
        .typing-cursor::after { content: "â–ˆ"; animation: blink 1s infinite; }
        @keyframes blink { 0%, 100% {opacity: 1;} 50% {opacity: 0;} }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="scanline"></div>

    <div class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-6">
        
        <div class="lg:col-span-12 flex justify-between items-end border-b border-[#333] pb-4 mb-4">
            <div>
                <h1 class="text-3xl text-white font-bold tracking-tighter">SDG-1 // <span style="color:var(--neon)">NEURAL_NET</span></h1>
                <p class="text-xs text-gray-500 uppercase">System Status: Online | Node: Abu Dhabi</p>
            </div>
            <div class="text-right">
                <div class="text-xs text-gray-500">TARGET REGION</div>
                <select id="region" onchange="runAI()" class="w-32 text-right bg-transparent border-none text-white font-bold p-0">
                    {% for r in regions %}
                    <option value="{{ r }}">{{ r }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <div class="lg:col-span-4 space-y-4">
            <div class="panel">
                <h3 class="text-xs text-gray-400 mb-4">>> INPUT_PARAMETERS</h3>
                <div class="space-y-4">
                    <div>
                        <label class="text-xs uppercase">Monthly Income (<span id="curr_sym">UNIT</span>)</label>
                        <input type="number" id="income" value="5000" oninput="runAI()">
                    </div>
                    <div>
                        <label class="text-xs uppercase">Education Level (Years)</label>
                        <input type="number" id="edu" value="12" oninput="runAI()">
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                        <div>
                            <label class="text-xs uppercase">Household Size</label>
                            <input type="number" id="h_size" value="4" oninput="runAI()">
                        </div>
                        <div>
                            <label class="text-xs uppercase">Workers</label>
                            <input type="number" id="workers" value="1" oninput="runAI()">
                        </div>
                    </div>
                </div>
            </div>

            <div class="panel">
                <h3 class="text-xs text-gray-400 mb-2">>> FACTOR_IMPACT_ANALYSIS</h3>
                <canvas id="impactChart" height="200"></canvas>
            </div>
        </div>

        <div class="lg:col-span-5 flex flex-col gap-6">
            <div class="panel flex-1 flex flex-col justify-center items-center text-center relative">
                <div class="absolute top-2 left-2 text-[10px] text-gray-600">ID: RISK_CALC_V4</div>
                
                <h2 class="text-gray-400 text-sm uppercase tracking-widest mb-2">Calculated Vulnerability</h2>
                <div class="text-7xl font-bold text-white mb-2" id="risk_val">0%</div>
                <div id="risk_bar_container" class="w-full h-1 bg-[#222] mt-4 relative">
                    <div id="risk_bar" class="h-full bg-[#ccff00] absolute top-0 left-0 transition-all duration-300" style="width:0%"></div>
                </div>
            </div>

            <div class="panel bg-black border-dashed h-64 overflow-y-auto font-mono text-xs p-4">
                <div class="text-[#ccff00] mb-2">root@ai-system:~$ initiate_scan</div>
                <div id="terminal_output" class="text-gray-300 space-y-2 typing-cursor">
                    </div>
            </div>
        </div>

        <div class="lg:col-span-3">
            <div class="panel h-full flex flex-col">
                <h3 class="text-xs text-gray-400 mb-6">>> OPTIMIZATION_STRATEGY</h3>
                
                <div class="flex-1 flex flex-col gap-4">
                    <div class="p-4 bg-[#ccff00]/10 border border-[#ccff00]/30 rounded">
                        <div class="text-[10px] text-[#ccff00] uppercase mb-1">Recommended Action</div>
                        <div id="strat_title" class="text-lg font-bold text-white">--</div>
                    </div>

                    <div class="p-4 bg-[#222] border border-[#333] rounded">
                        <div class="text-[10px] text-gray-500 uppercase mb-1">Projected Leverage</div>
                        <div class="text-2xl font-bold text-white"><span id="leverage_val">0</span>%</div>
                        <div class="text-[10px] text-gray-400">Risk reduction potential</div>
                    </div>
                    
                    <div class="mt-auto text-[10px] text-gray-600 leading-tight">
                        *AI uses sensitivity coefficients to determine the highest yield variable for your specific case.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let impactChart;

        function initChart() {
            const ctx = document.getElementById('impactChart').getContext('2d');
            impactChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Income', 'Family', 'Edu Buff'],
                    datasets: [{
                        label: 'Risk Contribution',
                        data: [0, 0, 0],
                        backgroundColor: ['#ef4444', '#ef4444', '#10b981'],
                        barThickness: 20
                    }]
                },
                options: {
                    indexAxis: 'y',
                    plugins: { legend: {display: false} },
                    scales: {
                        x: { grid: {color: '#222'}, ticks: {display: false} },
                        y: { grid: {display: false}, ticks: {color: '#666', font: {family:'JetBrains Mono'}} }
                    }
                }
            });
        }

        async function runAI() {
            const data = {
                income: document.getElementById('income').value || 0,
                education: document.getElementById('edu').value || 0,
                household_size: document.getElementById('h_size').value || 1,
                working_members: document.getElementById('workers').value || 1,
                region: document.getElementById('region').value
            };

            const res = await fetch('/process', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(data)
            });
            const r = await res.json();

            // 1. Update Main Display
            document.getElementById('risk_val').innerText = r.risk + "%";
            document.getElementById('risk_bar').style.width = r.risk + "%";
            document.getElementById('curr_sym').innerText = r.currency;
            
            // Color Logic
            const color = r.risk > 50 ? '#ef4444' : r.risk > 30 ? '#f59e0b' : '#ccff00';
            document.getElementById('risk_val').style.color = color;
            document.getElementById('risk_bar').style.backgroundColor = color;

            // 2. Update Chart (The Why)
            impactChart.data.datasets[0].data = [
                r.breakdown["Income Stress"], 
                r.breakdown["Family Load"], 
                -r.breakdown["Edu Protection"] // Negative because it helps
            ];
            impactChart.update();

            // 3. Update Strategy (The Value)
            document.getElementById('strat_title').innerText = r.ai_insight.strategy;
            document.getElementById('leverage_val').innerText = r.ai_insight.leverage_score;

            // 4. Typewriter Terminal Effect
            const term = document.getElementById('terminal_output');
            term.innerHTML = '';
            const msg = `> Analyzing vector [Income: ${data.income}, Edu: ${data.education}]... \n> Calculation Complete. \n> ${r.ai_insight.message}`;
            
            let i = 0;
            function typeWriter() {
                if (i < msg.length) {
                    term.innerHTML += msg.charAt(i);
                    i++;
                    setTimeout(typeWriter, 20); // Typing speed
                }
            }
            typeWriter();
        }

        window.onload = function() {
            initChart();
            runAI();
        };
    </script>
</body>
</html>
